---
output:
  html_document:
    keep_md: true
    fig_height: 1
    fig_width: 1
    toc: yes
    toc_depth: 1
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
    code_folding: hide
---
<style>
    body .main-container {
        width: 2000px;
        margin-left: 20px;
        margin-right: 20px;
    }
#TOC {
  background:url("images/iceslogo.png") ;
  background-size: contain;
  padding-top: 100px !important;
  background-repeat: no-repeat;
  position: fixed;
  font-size: 12px;
  left: 0;
  top: 0;
  width: 200px;
  height: 80%;
  overflow:auto;
}
</style>

<style type="text/css"> body, td { font-size: 16px; } width: 800px code.r{ font-size: 12px; } pre { font-size: 12px }

h1 { /* Header 1 */
  font-size: 24px;
  color: Grey;
}
h2 { /* Header 2 */
    font-size: 18px;
  color: Black;
}
 .col2 {
    columns: 2 220px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 220px; /* chrome, safari */
    -moz-columns: 2 220px;    /* firefox */
  }
</style>

---
<a id="top"></a>

# ICES advice 2018

## "Herring (Clupea harengus) in subdivisions 25–29 and 32, excluding the Gulf of Riga (central Baltic Sea)"


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
#<a href="#top">Back to top</a>
```

***
```{r  out.width = "50%"}
knitr::include_graphics("images/atlantic-herring.png")
knitr::include_graphics("images/map.png")
```


[Go to latest advice](http://www.ices.dk/sites/pub/Publication%20Reports/Advice/2018/2018/her.27.25-2932.pdf)  
[Go to Standard Graphs page](https://standardgraphs.ices.dk/manage/ViewGraphsAndTables.aspx?key=9428)  
[Go to Transparent Assessment Framework page](https://github.com/ices-taf/2016_cod-347d)

***

# ICES advice on fishing opportunities
ICES advises that when the EU multiannual plan (MAP) is applied, catches in 2019 that correspond to the F ranges in the
plan are between **115 591** tonnes and **192 787** tonnes. According to the MAP, catches higher than those corresponding
to FMSY (155 333 tonnes) can only be taken under conditions specified in the MAP, whilst the entire range is considered
precautionary when applying the ICES advice rule. This advice applies to all catches from the stock, including those taken
in Subdivision 28.1.
 <br> 

***

# Stock development over time
Spawning-stock biomass (SSB) decreased until 2001 and then increased, and it has been above MSY Btrigger since 2007.
Fishing mortality (F) increased until 2000 and then decreased, remaining below FMSY between 2004 to 2014. F has been
above FMSY since 2015. Recruitment in 2015 is estimated to be the highest of the whole time-series.

<div class="col2">
```{r sag1, echo=FALSE, fig.height=3.5, fig.width=3.5}

 library(htmlwidgets)
 library(dplyr)
 library(ggplot2)
 library(dygraphs)
 library(htmltools)
 library(widgetframe)
 data <- read.csv("Data/her/herdata.csv")

 dyBarChart <- function(dygraph) {
  dyPlotter(dygraph = dygraph,
            name = "BarChart",
            path = system.file("examples/plotters/barchart.js",
                               package = "dygraphs"))
}

 catches <- data %>% select(Year, catches)
 catches$catches <- catches[, "catches"]/1000
 recruitment<- data %>% select(Year, low_recruitment, recruitment, high_recruitment)
 
 dygraph(catches, main = "Catches")%>%
   dyRangeSelector()%>%
   dyOptions(colors = RColorBrewer::brewer.pal(3, "Set2"), drawGrid = FALSE,maxNumberWidth = 4)%>%
   dyAxis("y")%>%
   dyBarChart()
 
 dygraph(recruitment, main = "Recruitment(age 0)") %>%
   dyRangeSelector()%>%
   # dyOptions(colors = RColorBrewer::brewer.pal(3, "Set2"))%>%
   dyAxis("y")%>%
   dyBarChart()

 
```
</div>
<div class="col2">
```{r sag3, echo = FALSE, fig.height = 3.5, fig.width = 3.5}
library(dygraphs)
library(htmlwidgets)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(dygraphs)

dyBarChart <- function(dygraph) {
  dyPlotter(dygraph = dygraph,
            name = "BarChart",
            path = system.file("examples/plotters/barchart.js",
                               package = "dygraphs"))
} 

F <- data %>% select(Year, low_F, F,high_F, FLim, Fpa, FMSY )
 dygraph(F, main = "F") %>%
  dySeries(c("low_F", "F", "high_F"))%>%
   dyLimit(as.numeric(F[, 5]), color = "red")%>%
   dyRangeSelector()%>%
   dyOptions(colors = RColorBrewer::brewer.pal(3, "Set2"),
             drawGrid= FALSE,maxNumberWidth = 4)%>%
   dyAxis("y")
SSB <- data %>% select(Year, low_SSB, SSB,high_SSB, Blim, Bpa, MSYBtrigger)
 dygraph(SSB, main = "SSB") %>%
  dySeries(c("low_SSB", "SSB", "high_SSB"))%>%
   dyLimit(as.numeric(F[, 5]), color = "red")%>%
   dyRangeSelector()%>%
   dyOptions(colors = RColorBrewer::brewer.pal(3, "Set2"),
             drawGrid= FALSE,maxNumberWidth = 4)%>%
   dyAxis("y")
 
```
</div>


**Figure 1**  Herring in subdivisions 25–29 and 32, excluding the Gulf of Riga. Summary of the stock assessment. (SSB in 2018 is
predicted).
<br>

## Summary of the assessment

Herring in subdivisions 25–29 and 32, excluding the Gulf of Riga. Assessment summary. Weights are in tonnes.
Recruitment in thousands.

```{r summarysag, echo=FALSE}
library(icesSAG)

SAGsummary <- getSAG("her.27.25-2932", 2018, data = "summary", combine = TRUE, purpose = "Advice")
write.csv(SAGsummary, file = "SAGsummary.csv")

```

```{r download4}
library(magrittr)
 readLines("SAGsummary.csv") %>% 
   paste0(collapse="\n") %>% 
   openssl::base64_encode() -> encoded
```

[Download CSV](`r sprintf('data:text/csv;base64,%s', encoded)`)
 ***  
[Go to Top](#top)

# Stock and explotation status

<br>

ICES assesses that fishing pressure on the stock is above FMSY and below Fpa and Flim; spawning stock size is above MSY
Btrigger, Bpa, and Blim.
<br>
**State of the stock and fishery relative to reference points**
<br>
![](images/MGT_1.png)


***  

# Catch scenarios

<br>

**Herring in subdivisions 25–29 and 32, excluding the Gulf of Riga. Assumptions made for the interim year and in the forecast. Weights are in tonnes. Recruitment is in thousands.**


<br>
```{r catchoptionsbasis, echo=FALSE}
library(knitr)
library(readr)
library(kableExtra)
dt <- read.csv("Data/her/hercatchoptionsbasis.csv",header = T)
# dt <- dt [,-1] 
kable(dt, "html")%>% 
  row_spec(0, bold = T, color = "black", background = "lightgrey", align = "c")%>%
  column_spec(1, width = "20em")%>%
  column_spec(2, width = "20em")%>%
  column_spec(3, width = "45em")%>%
  kable_styling(position = "center", full_width = F, font_size = 7)

```

<br>

***

**Table 3 Herring in subdivisions 25–29 and 32, excluding the Gulf of Riga. Annual catch scenarios. All weights are in tonnes.**

<button class="btn btn-primary" data-toggle="collapse" data-target="#BlockName"> Show/Download Table </button>  
<div id="BlockName" class="collapse"> 
<br>
```{r catchoptionstable, echo=FALSE}
library(knitr)
library(readr)
library(kableExtra)
dt <- read.csv("Data/her/hercatchoptions.csv", header = T, row.names = 1)
# dt <- dt [,-1]
dt <- dt[complete.cases(dt),]
 kable(dt, "html") %>% kable_styling(position = "center")%>%
   row_spec(0, bold = T, color = "black", background = "lightgrey")%>%
   column_spec(1, width = "30em")%>%
         column_spec(2:7, width = "10em")%>%
   group_rows("ICES advice basis",1,1) %>%
   group_rows("Other options",2,9)
```
* SSB 2020 relative to SSB 2019.
** Advice value in 2019 relative to Advice value for EU MAP: FMSY 2018 (267 745 tonnes).
*** Advice value for  2019 relative to Advice value for EU MAP: Flower 2018 (200 236 tonnes).
^ Advice value for  2019 relative to Advice value for EU MAP: Fupper 2018 (331 510 tonnes).
^^ MAP multiannual plan (EU, 2016).
^^^ TAC = TAC in 2018: EU share 229 355 tonnes + Russian quota 29 500 tonnes + central Baltic herring stock caught in Gulf of Riga 4 340 tonnes (mean 2012–2016) − Gulf of Riga herring stock caught in central Baltic Sea 260 tonnes (mean 2012 – 2016) = 262 935 tonnes.


```{r download}
library(magrittr)
 readLines("Data/her/hercatchoptions.csv") %>% 
   paste0(collapse="\n") %>% 
   openssl::base64_encode() -> encoded
```

[Download CSV](`r sprintf('data:text/csv;base64,%s', encoded)`)
</div>
<br>
<br>
```{r catchscenariostable, echo=FALSE, fig.width=3}
library(knitr)
library(readr)
library(kableExtra)
dt <- read.csv("Data/her/herscenariosplot.csv") %>%
        select(Basis, F, Catch, SSB_2019, SSB_2020)
write.table (dt, "thing.txt",sep = ",")

colnames(dt)<- c("Basis", "F", "Catch_2018", "SSB_2019", "SSB_2020")
 kable(dt, "html") %>% kable_styling(position = "center")%>%
  kable_styling(bootstrap_options = "striped", full_width = F, font_size = 7)

```

## Version 1
```{r catchoptionsgraph, echo = FALSE,fig.height = 5, fig.width = 7}
library(ggplot2)
library(plotly)
 catchoptions <- read.csv("Data/her/herscenariosplot.csv")
 # labels <- catchoptions$Basis
 # labels <- as.character(labels)
 mypalette<-ggthemes::tableau_color_pal('tableau20')
 
 data <- catchoptions[order(catchoptions$F),] 
 
 
 p1 <- plot_ly(data, x = ~F) %>%
         layout(hovermode="TRUE", showlegend = TRUE,
           shapes = list(
             list(type = "line", fillcolor = "red", 
               line    = list(color = "red",
               width = 2,
               dash = "dot"),
               opacity = 0.5,
               x0      = 0.52,
               x1      = 0.52,
               xref    = "Flim",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Flim"),
             list(type = "line", fillcolor = "green", 
               line    = list(color = "green",
               width = 2,
               dash = "dot"), 
               opacity = 0.2, 
               x0      = 0.22,
               x1      = 0.22,
               xref    = "Fmsy",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fmsy"),
             list(type = "line", fillcolor = "orange", 
               line    = list(color = "orange",
               width = 2,
               dash = "dot"), 
               opacity = 1, 
               x0      = 0.41,
               x1      = 0.41,
               xref    = "Fpa",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fpa"),
             list(type = "line", fillcolor = "blue", 
               line    = list(color = "blue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 430000,
               y1      = 430000,
               yref    = "Blim",
               name = "Blim"),
             list(type = "line", fillcolor = "lightblue", 
               line    = list(color = "lightblue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 600000,
               y1      = 600000,
               yref    = "Bpa = MSY Btrigger",
               text = "Bpa = MSY Btrigger",
               textposition = "bottom right"),
             list(type = "rect", fillcolor = "green", opacity = 0.2,
                  line = list(color = "green", opacity=0.2),
                  x0 = -0.3, x1 = 0.41, xref = "x",
                  y0 = 0, y1 = 1000000, yref = "y"),
             list(type = "rect", fillcolor = "orange", opacity = 0.2,
                  line = list(color = "orange", opacity=0.2),
                  x0 = 0.41, x1 = 0.52, y0 = 0, y1 = 1000000),
             list(type = "rect", fillcolor = "red", opacity = 0.2,
                  line = list(color = "red", opacity=0.2),
                  x0 = 0.52, x1 = 1, y0 = 0, y1 = 1000000)),
           yaxis= list(title = 'tonnes', showgrid =FALSE),
    xaxis=list(title = 'Fishing mortality according to catch scenarios', showgrid= FALSE, tickmode = "array",tickvals = c(0.22,0.41,0.52), ticktext = c("Fmsy","Fpa", "Flim"), tickangle = 45),
    annotations=
        list(
            x= 1,
            y=c(430000,600000),
            xref= '1',
            yref='y',
            text=c('Blim','Bpa = MSY Btrigger'),
            showarrow = TRUE,
            ax= 70,
            ay= 0
        ) 
    )%>%
         add_trace(y = ~ SSB_2019, name= 'SSB 2019', mode = 'lines+markers',opacity = 0.8, width= 0.2, text = data$Basis, hoverinfo = "text + x+ y") %>%
         add_trace(y = ~ SSB_2020, name= 'SSB 2020', mode = 'lines+markers',opacity = 0.8, width= 0.2, text = data$Basis, hoverinfo = "text + x+ y") %>%
          add_trace(y = ~ Catch, name = 'Catch 2018', mode = 'lines+markers',text = data$Basis, hoverinfo = "text + x+ y")
                  
  p1$elementId <- NULL
  p1
```
 
## Version 2:
 <div class="col2">
```{r catchoptionsgraphv2, fig.height=3.5, fig.width=3.5}
library(ggplot2)
library(plotly)
 catchoptions <- read.csv("Data/her/herscenariosplot.csv")
 # labels <- catchoptions$Basis
 # labels <- as.character(labels)
 mypalette<-ggthemes::tableau_color_pal('tableau20')
 
 data <- catchoptions[order(catchoptions$F),] 
 
 
 p1 <- plot_ly(data, x = ~F) %>%
         layout(hovermode="TRUE", showlegend = FALSE,
           shapes = list(
             list(type = "line", fillcolor = "red", 
               line    = list(color = "red",
               width = 2,
               dash = "dot"),
               opacity = 0.5,
               x0      = 0.52,
               x1      = 0.52,
               xref    = "Flim",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Flim"),
             list(type = "line", fillcolor = "green", 
               line    = list(color = "green",
               width = 2,
               dash = "dot"), 
               opacity = 0.2, 
               x0      = 0.22,
               x1      = 0.22,
               xref    = "Fmsy",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fmsy"),
             list(type = "line", fillcolor = "orange", 
               line    = list(color = "orange",
               width = 2,
               dash = "dot"), 
               opacity = 1, 
               x0      = 0.41,
               x1      = 0.41,
               xref    = "Fpa",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fpa"),
             list(type = "line", fillcolor = "blue", 
               line    = list(color = "blue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 430000,
               y1      = 430000,
               yref    = "Blim",
               name = "Blim"),
             list(type = "line", fillcolor = "lightblue", 
               line    = list(color = "lightblue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 600000,
               y1      = 600000,
               yref    = "Bpa = MSY Btrigger",
               text = "Bpa = MSY Btrigger",
               textposition = "bottom right"),
             list(type = "rect", fillcolor = "green", opacity = 0.2,
                  line = list(color = "green", opacity=0.2),
                  x0 = -0.3, x1 = 0.41, xref = "x",
                  y0 = 0, y1 = 1000000, yref = "y"),
             list(type = "rect", fillcolor = "orange", opacity = 0.2,
                  line = list(color = "orange", opacity=0.2),
                  x0 = 0.41, x1 = 0.52, y0 = 0, y1 = 1000000),
             list(type = "rect", fillcolor = "red", opacity = 0.2,
                  line = list(color = "red", opacity=0.2),
                  x0 = 0.52, x1 = 1, y0 = 0, y1 = 1000000)),
           yaxis= list(title = 'tonnes', showgrid =FALSE),
    xaxis=list(title = 'F', showgrid= FALSE, tickmode = "array",tickvals = c(0.22,0.41,0.52), ticktext = c("Fmsy","Fpa", "Flim"), tickangle = 45)
    )%>%
         add_trace(y = ~ SSB_2019, name= 'SSB 2019', mode = 'lines+markers',opacity = 0.8, width= 0.2, text = data$Basis, hoverinfo = "text + x+ y") %>%
          add_trace(y = ~ Catch, name = 'Catch 2018', mode = 'lines+markers',text = data$Basis, hoverinfo = "text + x+ y")
                  
  p1$elementId <- NULL
  p1
  
  p2 <- plot_ly(data, x = ~F) %>%
         layout(hovermode="TRUE", showlegend = FALSE,
           shapes = list(
             list(type = "line", fillcolor = "red", 
               line    = list(color = "red",
               width = 2,
               dash = "dot"),
               opacity = 0.5,
               x0      = 0.52,
               x1      = 0.52,
               xref    = "Flim",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Flim"),
             list(type = "line", fillcolor = "green", 
               line    = list(color = "green",
               width = 2,
               dash = "dot"), 
               opacity = 0.2, 
               x0      = 0.22,
               x1      = 0.22,
               xref    = "Fmsy",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fmsy"),
             list(type = "line", fillcolor = "orange", 
               line    = list(color = "orange",
               width = 2,
               dash = "dot"), 
               opacity = 1, 
               x0      = 0.41,
               x1      = 0.41,
               xref    = "Fpa",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fpa"),
             list(type = "line", fillcolor = "blue", 
               line    = list(color = "blue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 430000,
               y1      = 430000,
               yref    = "Blim",
               name = "Blim"),
             list(type = "line", fillcolor = "lightblue", 
               line    = list(color = "lightblue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 600000,
               y1      = 600000,
               yref    = "Bpa = MSY Btrigger",
               text = "Bpa = MSY Btrigger",
               textposition = "bottom right"),
             list(type = "rect", fillcolor = "green", opacity = 0.2,
                  line = list(color = "green", opacity=0.2),
                  x0 = -0.3, x1 = 0.41, xref = "x",
                  y0 = 0, y1 = 1000000, yref = "y"),
             list(type = "rect", fillcolor = "orange", opacity = 0.2,
                  line = list(color = "orange", opacity=0.2),
                  x0 = 0.41, x1 = 0.52, y0 = 0, y1 = 1000000),
             list(type = "rect", fillcolor = "red", opacity = 0.2,
                  line = list(color = "red", opacity=0.2),
                  x0 = 0.52, x1 = 1, y0 = 0, y1 = 1000000)),
           yaxis= list(title = 'tonnes', showgrid =FALSE),
    xaxis=list(title = 'F', showgrid= FALSE, tickmode = "array",tickvals = c(0.22,0.41,0.52), ticktext = c("Fmsy","Fpa", "Flim"), tickangle = 45)
    )%>%
         add_trace(y = ~ SSB_2020, name= 'SSB 2020', mode = 'lines+markers',opacity = 0.8, width= 0.2, text = data$Basis, hoverinfo = "text + x+ y") %>%
          add_trace(y = ~ Catch, name = 'Catch 2018', mode = 'lines+markers',text = data$Basis, hoverinfo = "text + x+ y")
                  
  p2$elementId <- NULL
  p2
  
```
</div>  
  
## Version 3: 
  <div class="col2">
```{r catchoptionsgraphv3, echo = FALSE,fig.height=3.5, fig.width=3.5}
library(ggplot2)
library(plotly)
 catchoptions <- read.csv("Data/her/herscenariosplot.csv")
 # labels <- catchoptions$Basis
 # labels <- as.character(labels)
 mypalette<-ggthemes::tableau_color_pal('tableau20')
 
 data <- catchoptions[order(catchoptions$F),] 
 
 
 p1 <- plot_ly(data, x = ~F) %>%
         layout(hovermode="TRUE", showlegend = FALSE,
           shapes = list(
             list(type = "line", fillcolor = "red", 
               line    = list(color = "red",
               width = 2,
               dash = "dot"),
               opacity = 0.5,
               x0      = 0.52,
               x1      = 0.52,
               xref    = "Flim",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Flim"),
             list(type = "line", fillcolor = "green", 
               line    = list(color = "green",
               width = 2,
               dash = "dot"), 
               opacity = 0.2, 
               x0      = 0.22,
               x1      = 0.22,
               xref    = "Fmsy",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fmsy"),
             list(type = "line", fillcolor = "orange", 
               line    = list(color = "orange",
               width = 2,
               dash = "dot"), 
               opacity = 1, 
               x0      = 0.41,
               x1      = 0.41,
               xref    = "Fpa",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fpa"),
             list(type = "line", fillcolor = "blue", 
               line    = list(color = "blue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 430000,
               y1      = 430000,
               yref    = "Blim",
               name = "Blim"),
             list(type = "line", fillcolor = "lightblue", 
               line    = list(color = "lightblue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 600000,
               y1      = 600000,
               yref    = "Bpa = MSY Btrigger",
               text = "Bpa = MSY Btrigger",
               textposition = "bottom right"),
             list(type = "rect", fillcolor = "green", opacity = 0.2,
                  line = list(color = "green", opacity=0.2),
                  x0 = -0.3, x1 = 0.41, xref = "x",
                  y0 = 0, y1 = 1000000, yref = "y"),
             list(type = "rect", fillcolor = "orange", opacity = 0.2,
                  line = list(color = "orange", opacity=0.2),
                  x0 = 0.41, x1 = 0.52, y0 = 0, y1 = 1000000),
             list(type = "rect", fillcolor = "red", opacity = 0.2,
                  line = list(color = "red", opacity=0.2),
                  x0 = 0.52, x1 = 1, y0 = 0, y1 = 1000000)),
           yaxis= list(title = 'tonnes', showgrid =FALSE),
    xaxis=list(title = 'F', showgrid= FALSE, tickmode = "array",tickvals = c(0.22,0.41,0.52), ticktext = c("Fmsy","Fpa", "Flim"), tickangle = 45)
    )%>%
        add_trace(y = ~ SSB_2019, name= 'SSB 2019', type = 'bar',opacity = 0.8, width= 0.2, color = ~ SSB_2019,colors=c("darkblue","Yellow"), text = data$Basis, hoverinfo = "text + x+ y")%>%
          add_trace(y = ~ Catch, name = 'Catch 2018', mode = 'lines+markers',text = data$Basis, hoverinfo = "text + x+ y")
                  
  p1$elementId <- NULL
  p1
  
  p2 <- plot_ly(data, x = ~F) %>%
         layout(hovermode="TRUE", showlegend = FALSE,
           shapes = list(
             list(type = "line", fillcolor = "red", 
               line    = list(color = "red",
               width = 2,
               dash = "dot"),
               opacity = 0.5,
               x0      = 0.52,
               x1      = 0.52,
               xref    = "Flim",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Flim"),
             list(type = "line", fillcolor = "green", 
               line    = list(color = "green",
               width = 2,
               dash = "dot"), 
               opacity = 0.2, 
               x0      = 0.22,
               x1      = 0.22,
               xref    = "Fmsy",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fmsy"),
             list(type = "line", fillcolor = "orange", 
               line    = list(color = "orange",
               width = 2,
               dash = "dot"), 
               opacity = 1, 
               x0      = 0.41,
               x1      = 0.41,
               xref    = "Fpa",
               y0      = 0,
               y1      = 1000000,
               yref    = "y",
               name = "Fpa"),
             list(type = "line", fillcolor = "blue", 
               line    = list(color = "blue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 430000,
               y1      = 430000,
               yref    = "Blim",
               name = "Blim"),
             list(type = "line", fillcolor = "lightblue", 
               line    = list(color = "lightblue",
               width = 2,
               dash = "dash"), 
               opacity = 0.3, 
               x0      = -0.3,
               x1      = 1,
               xref    = "x",
               y0      = 600000,
               y1      = 600000,
               yref    = "Bpa = MSY Btrigger",
               text = "Bpa = MSY Btrigger",
               textposition = "bottom right"),
             list(type = "rect", fillcolor = "green", opacity = 0.2,
                  line = list(color = "green", opacity=0.2),
                  x0 = -0.3, x1 = 0.41, xref = "x",
                  y0 = 0, y1 = 1000000, yref = "y"),
             list(type = "rect", fillcolor = "orange", opacity = 0.2,
                  line = list(color = "orange", opacity=0.2),
                  x0 = 0.41, x1 = 0.52, y0 = 0, y1 = 1000000),
             list(type = "rect", fillcolor = "red", opacity = 0.2,
                  line = list(color = "red", opacity=0.2),
                  x0 = 0.52, x1 = 1, y0 = 0, y1 = 1000000)),
           yaxis= list(title = 'tonnes', showgrid =FALSE),
    xaxis=list(title = 'F', showgrid= FALSE, tickmode = "array",tickvals = c(0.22,0.41,0.52), ticktext = c("Fmsy","Fpa", "Flim"), tickangle = 45)
    )%>%
         add_trace(y = ~ SSB_2020, name= 'SSB 2020', type = 'bar',opacity = 0.8, width= 0.2, color = ~ SSB_2020,colors=c("darkblue","Yellow"), text = data$Basis, hoverinfo = "text + x+ y") %>%
          add_trace(y = ~ Catch, name = 'Catch 2018', mode = 'lines+markers',text = data$Basis, hoverinfo = "text + x+ y")
                  
  p2$elementId <- NULL
  p2
```
 </div> 
<br>

[Go to Top](#top)

# Basis of the advice  
***
<br>
**Table 4** Hake in subareas 4, 6, and 7, and in divisions 3.a, 8.a–b, and 8.d, Northern stock. The basis of the advice.
```{r advicebasis, echo=FALSE}
library(knitr)
library(readr)
library(kableExtra)
dt <- read.csv("Data/hke/hkeadvicebasis.csv", header = FALSE)
#dt <- dt [-1,] 
colnames(dt) <- NULL
kable(dt, "html")%>%kable_styling(position = "center")%>%
  column_spec(1, bold = T, color = "black", background = "lightgrey")

```

<br>

# Quality of the assessment  
***
<br>
The uncertainty in the assessment is relatively high, with large changes in biomass estimates in consecutive years. The model confidence intervals are an underestimate of uncertainty because they are narrower than interannual changes in estimates in consecutive years.
There is a lack of tuning data for the earlier years of the assessment, for some areas outside of subareas 7 and 8, and for the larger individuals in the population. Given the expansion of the stock into northern areas (ICES, 2017b), there is a potential that not all catches are reported for this stock. Biological sampling from these areas is also limited.
The data compilation of this stock is very complicated because it is exploited by several countries and the assessment model configuration is complex. In turn, the assessment model is very sensitive to the data and the settings used. Hence, it is extremely important for the quality of the assessment to have the complete data for all the countries on time and in the right format.

# Reference Points  
***
<br>
Herring in Subarea 4 and divisions 3.a and 7.d, autumn spawners. Reference points, values, and their technical basis.
```{r referencepoints, echo=FALSE}
library(knitr)
library(readr)
library(kableExtra)
dt <- read.csv("Data/hke/hkereferencepoints.csv")
dt <- dt [,-1] 
kable(dt, "html")%>%kable_styling(position = "center")%>%
  row_spec(0, bold = T, color = "black", background = "lightgrey")

```
<br>
```{r download2}
library(magrittr)
 readLines("Data/hke/hkereferencepoints.csv") %>% 
   paste0(collapse="\n") %>% 
   openssl::base64_encode() -> encoded
```
[Download CSV](`r sprintf('data:text/csv;base64,%s', encoded)`)

# Basis of the assessment  
***
<br>
Herring in Subarea 4 and divisions 3.a and 7.d, autumn spawners. Basis of the assessment and advice
```{r advicebla, echo=FALSE}
library(knitr)
library(readr)
library(kableExtra)
dt <- read.csv("Data/hke/hkeassessmentbasis.csv")
dt <- dt [,-1] 
kable(dt, "html")%>%kable_styling(position = "center")%>%
  row_spec(0, bold = T, color = "black", background = "lightgrey")

```

```{r download3}
library(magrittr)
 readLines("Data/hke/hkeassessmentbasis.csv") %>% 
   paste0(collapse="\n") %>% 
   openssl::base64_encode() -> encoded
```
[Download CSV](`r sprintf('data:text/csv;base64,%s', encoded)`)
[Go to Top](#top)

# Historical trends

```{r, echo=FALSE}
library(googleVis)
library(tidyr)
kobe <- read_csv("data/hke/kobe_data_2.csv")
hke <- kobe %>% filter(StockCode == "hke.27.3a46-8abd", EcoRegion == "Greater North Sea Ecoregion")
hke$StockCode <- NULL
hke$FisheriesGuild <- NULL
hke$EcoRegion <- NULL

bla <- hke %>% gather(Measures, value, -Year, -`F/Fmsy`, -`SSB/MSYBtrigger`)
# library(reshape2)
# hkelong <- melt(hke, id.vars = c("Year", "F", "SSB", "FMSY", "MSYBtrigger","catches", "landings", "discards"))

vis<- gvisMotionChart(bla, idvar= "Measures", timevar = "Year")
plot(vis)
```

http://127.0.0.1:30673/custom/googleVis/MotionChartID7603b1f6d16.html

